# FLAT-UP GYM LIFFアプリ仕様書 - AIフィットネス・プラットフォーム「相棒（AIBO）」

## 1. プロジェクト概要
- **目標:** 既存会員のエンゲージメントと満足度を最大化し、退会率を低下させる。
- **コンセプト:** 顧客至上主義に基づき、会員の成長をサポートする「専属AIトレーナー」をLINE上に実現する。
- **開発範囲（MVP）:** 予約システム、会員管理、**練習ノート機能（AI連携・短期記憶）**に集中。

## 2. システム構成
- **サーバー:** Xserver VPS (Ubuntu 25.04)
- **言語/フレームワーク:** Python (FastAPIなどを想定)
- **データベース:** SQLite/PostgreSQL (VPS内に構築)
- **フロントエンド:** LINE LIFF

## 3. データベース設計（主要テーブル）

| テーブル名 | 役割 | 記録する情報 |
| :--- | :--- | :--- |
| `users` | 会員名簿 | LINE ID (主キー)、氏名、現在のポイント、称号、レベル |
| `check_ins` | ポイント獲得記録 | ユーザーID、チェックイン日時、獲得ポイント |
| `notes` | **練習ノート記録** | ユーザーID、記録日時、ノートのテキスト（意識したこと、できたこと、課題） |
| `conversations` | **短期記憶** | ユーザーID、メッセージのテキスト、送信日時、送信者（ユーザー or AI） |

## 4. コア機能仕様：練習ノート（AI連携・短期記憶）

### 4.1. 練習ノート機能
- **UI:** LIFFアプリ内に、テキスト入力フォームと「記録する」ボタンを配置。
- **動作:** 会員が練習内容や気づきをテキストで記録し、データベースに保存する。

### 4.2. AI自動返信機能
- **連携:** 既存のAIシステムをVPSに移植し、練習ノートの入力時に呼び出す。
- **短期記憶:** AIは返信生成時、`conversations`テーブルから**直近5〜10個の会話ログ**を取得し、文脈を考慮した返信を行う。
- **返信形式:** AIが生成したテキストメッセージを、LINEのプッシュ通知でユーザーに自動送信する。

### 4.3. ポイント・称号システム
- **ポイント獲得:**
    - ジム設置のQRコード読み取り（チェックイン）でポイント付与。
    - SNS投稿（指定ハッシュタグとURLを含む）でポイント2倍。
    - 練習ノートの記録でポイント付与。
- **称号システム:** 累積ポイントに応じて、会員のレベルと称号（例：ルーキー、ファイター、チャンピオン）を付与し、LIFFアプリのマイページに表示する。
- **リワード（報酬）:**
    - **コストゼロリワード:** 練習ノートのAIフィードバック、限定称号、インストラクターからの個別メッセージ、SNSでの紹介（許可制）。

## 5. 体験クラス予約機能（非会員向け）
- **動線:** LINE広告からの流入ユーザーをLIFFアプリへ誘導。
- **UI:**
    1.  「体験クラス予約」ボタンを最前面に配置。
    2.  ユーザーがボタンを押すと、**向こう1週間の予約可能日時**（こちらで設定した固定枠）をカレンダー形式で表示。
    3.  ユーザーが日時を選択し、氏名・連絡先を入力して予約完了。
- **自動返信:** 予約完了後、LINEの自動返信で「確認しました。担当者から改めてご連絡します」というメッセージと、丁寧なお礼を送信。
